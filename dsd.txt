 private long GetOrCreateUser(IRBADatabaseEntities dbDatabase, string email, out string userName, out string opcoName)
 {
     // Extract username and OpCo name from the email
     var emailParts = email.Split('@');
     var userId = emailParts[0]; // Extract part before @ (e.g., "shubham.k")
     userName = userId.Replace('.', ' '); // Replace '.' with a space (e.g., "shubham k")
     opcoName = emailParts[1].ToLower(); // Extract part after @ (e.g., "global.ntt")

     // Determine if the email belongs to "global.ntt" domain
     bool isExternal = !opcoName.Contains("global.ntt");

     // Check if the user already exists
     var existingUser = dbDatabase.User_Details.FirstOrDefault(u => u.User_Email == email);
     if (existingUser != null)
     {
         // User exists, return the existing Id
         return existingUser.Id;
     }

     // If user doesn't exist, create a new user
     var newUser = new User_Details
     {
         User_Id = userId, // User Id from email (e.g., "shubham.k")
         User_Name = userName, // User Name (e.g., "shubham k")
         User_Email = email, // Email
         OpCoName = opcoName, // OpCo Name (e.g., "global.ntt")
         IsExternal = isExternal ? true : false, // Set IsExternal (1 for external, 0 for internal)
         Country_Id = "IN", // Default country
         User_Group = "NA" // Default User Group
     };

     // Save the new user in the database
     dbDatabase.User_Details.Add(newUser);
     dbDatabase.SaveChanges();

     // Return the new user's Id
     return newUser.Id;
 }

