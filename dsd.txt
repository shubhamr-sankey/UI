-- orbit_64407564mmy3009.test_results_vw source

CREATE OR REPLACE VIEW orbit_64407564mmy3009.test_results_vw
AS SELECT DISTINCT COALESCE(ss.subject_id, sp.subject_id) AS subject_id, ss.study_arm, ss.cohort, ss.study_subject_status, ss.date_enrollment, ss.date_termination, ss.date_treat_termination, ss.date_screening, ss.date_screen_failure, t.site_id, t.site_country_name, s.specimen_test_id, s.specimen_id, s.study_id, s.vendor_id, s.vendor_specimen_id, s.test_code, s.test_name, s.test_category, s.test_result_orig_value, s.test_result_orig_value_string, s.test_result_orig_value_numeric, s.test_result_orig_value_datetime, s.test_result_orig_value_cancelled, s.test_result_orig_unit, s.test_result_std_value, s.test_result_std_unit, s.test_status, s.basline_flag, s.test_start_date_time, s.test_end_date_time, s.test_category_code, s.test_result_date, s.test_filed_date, s.test_review_date, s.reason_test_qualified_or_failed, s."comment", s.labcorp_sequence_num, s.run_id, s.composite_primary_key, s.row_id, NULL::text AS test_type, sp.visit_id, v.vendor_name, coi.report_value
   FROM orbit_64407564mmy3009.specimen_test s
   JOIN orbit_64407564mmy3009.codes_of_interest coi ON s.test_code::text = coi.value::text
   JOIN ( SELECT sp.specimen_id, sp.accession_number, sp.study_subject, sp.study_id, sp.subject_id, sp.pre_screening_id, sp.visit_id, sp.vendor_id, sp.specimen_class, sp.specimen_type, sp.storage_location, sp.storage_state, sp.storage_temperature, sp.vendor_specimen_id, sp.vendor_subject_id, sp.vendor_study_id, sp.site_specimen_id, sp.specimen_condition, sp.specimen_extract_location, sp.specimen_collection_date, sp.specimen_received_date, sp.vendor_specimen_type, sp.specimen_status, sp.specimen_accession_date, sp.specimen_reporting_date, sp.repeat_status, sp.repeat_times, sp.number_of_slides, sp.number_of_slides_needed, sp.reason_qualified_or_failed, sp.sample_pass_fail_status, sp.run_id, sp.composite_primary_key, sp.row_id
      FROM orbit_64407564mmy3009.specimen sp
     WHERE sp.specimen_status IS NOT NULL) sp ON s.specimen_id::text = sp.specimen_id::text AND s.vendor_id = sp.vendor_id
   JOIN orbit_64407564mmy3009.study_subject ss ON "right"(sp.subject_id::text, 11) = "right"(ss.subject_id::text, 11)
   LEFT JOIN orbit_64407564mmy3009.study_site sst ON ss.site_id::text = sst.site_id::text AND ss.study_id::text = sst.study_id::text
   LEFT JOIN orbit_64407564mmy3009.site t ON ss.site_id::text = t.site_id::text AND ss.study_id::text = t.study_id::text AND sst.site_country::text = t.site_country_code::text
   LEFT JOIN orbit_64407564mmy3009.vendor v ON s.vendor_id = v.vendor_id;
